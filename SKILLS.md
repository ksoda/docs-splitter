# SKILLS.md

本ドキュメントは、本システムを設計・維持・拡張するために必要な
設計思想および技術的能力を定義する。

本プロジェクトは以下の思想を統合的に採用する：

- A Philosophy of Software Design
- Grokking Simplicity
- Unit Testing Principles, Practices, and Patterns
- ソフトウェアテスト徹底指南書
- Domain Modeling Made Functional

---

# 1. 設計哲学

## 1.1 複雑性の制御

- 深いモジュールを設計する
- 情報隠蔽を徹底する
- 変更理由を局所化する
- 依存方向を明確にする
- 認知負荷を最小化する

---

## 1.2 データ中心設計

- 副作用を境界に隔離する
- 純粋関数中心の設計
- 暗黙状態を持たない
- データ構造を明示する

---

## 1.3 ドメイン駆動・型駆動設計

- ドメイン概念を型で表現する
- 不正状態を表現不可能にする
- 失敗を型で扱う
- 値オブジェクトを活用する
- 文字列ベースの曖昧な状態管理を避ける

---

# 2. アーキテクチャ原則

1. 構造整合性を最優先
2. 層間責務を明確化
3. 境界で必ず検証
4. 内部は型付き不変モデル
5. 副作用は限定的
6. トークン制御は明示設計
7. 失敗は隠蔽しない
8. 不正状態を作らない設計を優先

---

# 3. 各層の責務

## adapters
- 外部ライブラリ接続
- 動的データの正規化
- 入力検証

## core
- ドメインモデル定義
- 純粋ロジック
- I/O禁止

## pipeline
- 処理統制
- モデル変換
- エラー伝播管理

## services
- 外部API連携
- 入出力検証
- 冪等設計
- タイムアウト制御

---

# 4. 失敗処理設計

- OCR失敗は明示的に扱う
- ページ範囲不整合は例外化
- 要約失敗は再試行戦略を設計
- 例外は分類する
- 構造化ログを出力する

---

# 5. 型安全戦略

- mypy / pyright strict運用
- Pydanticによる境界検証
- dataclassによる不変モデル
- dict横流し禁止
- Optional乱用禁止

---

# 6. テスト戦略

## 原則

- 振る舞いを検証する
- 実装詳細に依存しない
- 1テスト1概念
- AAA構造を守る
- テストは仕様の記述である

## 対象

- 階層正規化
- ページ範囲確定
- トークン分割アルゴリズム
- エラー分類
- 型変換ロジック

---

# 7. 必須スキル

- PDF内部構造理解
- OCR前処理
- 型駆動設計
- 階層データ処理
- トークン制御設計
- テスト設計理論
- エラー設計

---

# 8. 推奨スキル

- 並列処理設計
- ベクトル検索
- TTS設計
- パフォーマンス分析
- ロギング設計

